<!DOCTYPE html>
<html>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<head>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115491079-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115491079-1');
</script>
	
	<script>
    (function (w,d,s,o,f,js,fjs) {
        w['circleWidget']=o;w[o] = w[o] || function () { (w[o].q = w[o].q || []).push(arguments) };
        js = d.createElement(s), fjs = d.getElementsByTagName(s)[0];
        js.id = o; js.src = f; js.async = 1; fjs.parentNode.insertBefore(js, fjs);
    }(window, document, 'script', 'mw', 'https://community.visiongeek.io/external/widget.js'));

    mw('init', {
      community_public_uid: 'cf8e30b0',
      brand_color: '#506CF0'
    });

    // Optional: pass in a default space slug and/or topic slug
    mw('setDefaults', {
       space_slug: 'blog',
       topic_slug: 'yolo-object-detection-with-opencv-and-python'
     });
    </script>


    <title>YOLO Object Detection with OpenCV and Python</title>
    <meta name="description" content="Object detection using OpenCV dnn module with a pre-trained YOLO v3 model with Python. Detect 80 common objects in context including car, bike, dog, cat etc."/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:site" content="arunponnusamy.com"/>
    <meta name="twitter:creator" content="@ponnusamy_arun"/>
    <meta name="twitter:image:src" content="http://www.arunponnusamy.com/images/yolo-object-detection-opencv-python/yolo-object-detection.jpg"/>

    <meta charset="utf-8"/>
    <meta property="og:title" content="YOLO Object Detection with OpenCV and Python">
    <meta property="og:image" content="images/yolo-object-detection-opencv-python/yolo-object-detection.jpg">
    <meta property="og:description" content="Object detection using OpenCV dnn module with a pre-trained YOLO v3 model with Python. Detect 80 common objects in context including car, bike, dog, cat etc. ">
    <meta property="og:url" content="arunponnusamy.com">

    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="main.css">
    
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
</head>

<body>

<header>
    <div class="container">
        <div class="row">
            <h2 class="col-sm-4 text-left">
            <a href="index.html">Arun Ponnusamy</a></h2>
            <nav class="col-sm-8 text-right">
            <h3>
            <a href="index.html">Home</a></h3>
	    <h3>
            <a href="about.html">About</a></h3>
	    <h3><a href="https://book.arunponnusamy.com/computer-vision-essentials/">Book</a></h3>
            <h3>
	    <a href="https://github.com/arunponnusamy/cvlib">Project</a></h3>
	    <h3><a href="https://arunponnusamy.substack.com">Newsletter</a></h3>
            <h3>
            <a href="ArunPonnusamy-CV.pdf">CV</a></h3>
            <h3>
            <a href="contact.html">Contact</a></h3>            
            </nav>
        </div>
    </div>

</header>

<section>
    <div>
        <h1 class="col-sm-offset-3 col-sm-6 col-sm-offset-3">YOLO Object Detection with OpenCV and Python</h1>
	<p id="author" class="col-sm-offset-3 col-sm-6 col-sm-offset-3">28 Jul 2018 Arun Ponnusamy<p>
        <img class="col-sm-offset-4 col-sm-4 col-sm-offset-4" src="images/yolo-object-detection-opencv-python/yolo-object-detection.jpg"/>
        <p class="col-sm-offset-4 col-sm-4 col-sm-offset-4" id="source">Image Source: <a href="https://github.com/pjreddie/darknet/blob/master/data/dog.jpg">DarkNet github repo</a></p>
	
	<p></p>
	<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">If you have been keeping up with the advancements in the area of object detection, you might have got used to hearing this word 'YOLO'. It has kind of become a buzzword.</p>

<h2 class="col-sm-offset-3 col-sm-6 col-sm-offset-3">What is YOLO exactly?</h2>


	<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">YOLO (You Only Look Once) is a method / way to do object detection. It is the algorithm /strategy behind how the code is going to detect objects in the image.</p>

	<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">The official implementation of this idea is available through <a href="https://pjreddie.com/darknet/">DarkNet</a> (neural net implementation from the ground up in 'C' from the author). It is available on <a href"https://github.com/pjreddie/darknet">github</a> for people to use.</p>
		
	<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Earlier detection frameworks, looked at different parts of the image multiple times at different scales and repurposed image classification technique to detect objects. This approach is slow and inefficient.</p>
	
<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">YOLO takes entirely different approach. It looks at the entire image only once and goes through the network once and detects objects. Hence the name. It is very fast. That’s the reason it has got so popular. </p>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">There are other popular object detection frameworks like <b>Faster R-CNN</b> and <b>SSD</b> that are also widely used. </p>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">In this post, we are going to look at how to use a pre-trained YOLO model with OpenCV and start detecting objects right away.</p>

	<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3 text-center">.    .    .</p>
		
<h2 class="col-sm-offset-3 col-sm-6 col-sm-offset-3">OpenCV dnn module</h2>
     
	<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">DNN (Deep Neural Network) module was initially part of <code>opencv_contrib</code> repo. It has been moved to the master branch of <code>opencv</code> repo last year, giving users the ability to run inference on pre-trained deep learning models within OpenCV itself. </p>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">(One thing to note here is, <code>dnn</code> module is not meant be used for training. It’s just for running inference on images/videos.)</p>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Initially only Caffe and Torch models were supported. Over the period support for different frameworks/libraries like TensorFlow is being added. </p>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Support for YOLO/DarkNet has been added recently. We are going to use the OpenCV dnn module with a pre-trained YOLO model for detecting common objects.</p>

<h2 class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Let’s get started ..</h2>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Enough of talking. Let’s start writing code. (in Python obviously)</p>

<div class="col-sm-offset-3 col-sm-6 col-sm-offset-3">
<script src="https://gist.github.com/arunponnusamy/263037b45089e8510c126beae63e75eb.js"></script></div>

<h3 class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Installing dependencies</h3>
<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Following things are needed to execute the code we will be writing.</p>

<ul class="col-sm-offset-4 col-sm-4 col-sm-offset-4">
            <li>Python 3</li>
	    <li> Numpy </li>
	    <li> OpenCV Python bindings</li>

</ul>

<h3 class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Python 3</h3>


<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">If you are on Ubuntu, it’s most likely that Python 3 is already installed. Run <code>python3</code> in terminal to check whether its installed. If its not installed use</p>

<code class="col-sm-offset-3 col-sm-6 col-sm-offset-3">sudo apt-get install python3</code>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">For macOS please refer my earlier post on <a href="http://www.arunponnusamy.com/deep-learning-setup-macos.html">deep learning setup for macOS</a>.</p>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">I highly recommend using Python <b>virtual environment</b>. Have a look at my earlier  <a href="http://www.arunponnusamy.com/deep-learning-setup-macos.html">post</a> if you need a starting point.</p>

<h3 class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Numpy</h3>
<code class="col-sm-offset-3 col-sm-6 col-sm-offset-3">pip install numpy</code>


<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">This should install <code>numpy</code>. Make sure <code>pip</code> is linked to Python 3.x ( <code>pip -V</code> will show this info)</p>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">If needed use <code>pip3</code>. Use <code>sudo apt-get install python3-pip</code> to get <code>pip3</code> if not already installed.</p>

<h3 class="col-sm-offset-3 col-sm-6 col-sm-offset-3">OpenCV-Python</h3>
<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">You need to compile OpenCV from source from the master branch on <a href="https://github.com/opencv/opencv">github</a> to get the Python bindings. (recommended)</p>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Adrian Rosebrock has written a good blog post on <a href="https://www.pyimagesearch.com/2017/09/25/configuring-ubuntu-for-deep-learning-with-python/">PyImageSearch</a> on this. (Download the source from master branch instead of from archive) </p>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">If you are feeling overwhelmed by the instructions to get OpenCV Python bindings from source, you can get the unofficial Python package using </p>

<code class="col-sm-offset-3 col-sm-6 col-sm-offset-3"> pip install opencv-python </code>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">This is not maintained officially by <a href="opencv.org">OpenCV.org</a>. It’s a community maintained one. Thanks to the efforts of <a href="github.com/skvark">Olli-Pekka Heinisuo</a>. </p>

<h2 class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Command line arguments</h2>
<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">The script requires four input arguments.</p>
<ul class="col-sm-offset-4 col-sm-4 col-sm-offset-4">
            <li>input image</li>
	    <li>YOLO config file</li>
	    <li>pre-trained YOLO weights </li>
	    <li>text file containing class names </li>

</ul>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Download all of these files using the form below.</p>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3"><script async data-uid="9a7f31108c" src="https://expert-musician-1659.ck.page/9a7f31108c/index.js"></script></p>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">You can also download the pre-trained weights in Terminal by typing</p>

<code class="col-sm-offset-3 col-sm-6 col-sm-offset-3">wget https://pjreddie.com/media/files/yolov3.weights</code>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">This particular model is trained on </a href="http://cocodataset.org">COCO dataset</a> (common objects in context) from Microsoft. It is capable of detecting 80 common objects. You can download the full list using the form above.</p>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Input image can be of your choice. Sample input is available along with the source code for this post.</p>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Run the script by typing</p>

<code class="col-sm-offset-3 col-sm-6 col-sm-offset-3">$ python yolo_opencv.py --image dog.jpg --config yolov3.cfg --weights yolov3.weights --classes yolov3.txt </code>


<h2 class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Preparing input</h2>

<div class="col-sm-offset-3 col-sm-6 col-sm-offset-3">
<script src="https://gist.github.com/arunponnusamy/64a0fcec27fea6abf3ac9f26485b9d6c.js"></script></div>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Read the input image and get its width and height. </p>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Read the text file containing class names in human readable form and extract the class names to a list.</p>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Generate different colors for different classes to draw bounding boxes. </p>

<code class="col-sm-offset-3 col-sm-6 col-sm-offset-3">net = cv2.dnn.readNet(args.weights, args.config)</code>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Above line reads the weights and config file and creates the network.</p>

<code class="col-sm-offset-3 col-sm-6 col-sm-offset-3"><p>blob = cv2.dnn.blobFromImage(image, scale, (Width,Height), (0,0,0), True, crop=False)</p>
<p>net.setInput(blob)</p></code>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Above lines prepares the input image to run through the deep neural network. </p>

<h2 class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Output layer and bounding box
</h2>

<div class="col-sm-offset-3 col-sm-6 col-sm-offset-3">
<script src="https://gist.github.com/arunponnusamy/de373e1a579e1107296954c2d9f05b2f.js"></script></div>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Generally in a sequential CNN network there will be only one output layer at the end. In the YOLO v3 architecture we are using there are multiple output layers giving out predictions. <code>get_output_layers() </code>function gives the names of the output layers. An output layer is not connected to any next layer.</p>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3"><code>draw_bounding_box()</code> function draws rectangle over the given predicted region and writes class name over the box. If needed, we can write the confidence value too.</p>

<h2 class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Running inference</h2>
<div class="col-sm-offset-3 col-sm-6 col-sm-offset-3">
<script src="https://gist.github.com/arunponnusamy/220022a22c7367b38bf5ff95468815b9.js"></script></div>

<code class="col-sm-offset-3 col-sm-6 col-sm-offset-3"> outs = net.forward(get_output_layers(net))</code>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Above line is where the exact feed forward through the network happens. Moment of truth. If we don’t specify the output layer names, by default, it will return the predictions only from final output layer. Any intermediate output layer will be ignored.</p>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">We need go through each detection from each output layer to get the class id, confidence and bounding box corners and more importantly ignore the weak detections (detections with low confidence value).</p>

<h2 class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Non-max suppression</h2>

<div class="col-sm-offset-3 col-sm-6 col-sm-offset-3">
<script src="https://gist.github.com/arunponnusamy/e898be8a55ecee45b1099620cb6a9b5b.js"></script></div>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Even though we ignored weak detections, there will be lot of duplicate detections with overlapping bounding boxes. Non-max suppression removes boxes with high overlapping.</p>

<img class="col-sm-offset-3 col-sm-6 col-sm-offset-3" src="https://www.pyimagesearch.com/wp-content/uploads/2018/05/gentle_guide_nms.jpg"/>
<p class="col-sm-offset-4 col-sm-4 col-sm-offset-4" id="source">Source: <a href="https://www.pyimagesearch.com/2018/05/14/a-gentle-guide-to-deep-learning-object-detection/">PyImageSearch</a></p>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Finally we look at the detections that are left and draw bounding boxes around them and display the output image.</p>

<img class="col-sm-offset-4 col-sm-4 col-sm-offset-4" src="images/yolo-object-detection-opencv-python/object-detection2.jpg"/>
<p class="col-sm-offset-4 col-sm-4 col-sm-offset-4" id="source"><a href="https://github.com/pjreddie/darknet/blob/master/data/person.jpg">source</a></p>

<img class="col-sm-offset-4 col-sm-4 col-sm-offset-4" src="images/yolo-object-detection-opencv-python/object-detection3.jpg"/>
<p class="col-sm-offset-4 col-sm-4 col-sm-offset-4" id="source"><a href="https://c8.alamy.com/comp/D5E4G0/woman-on-bicycle-waiting-at-stop-sign-to-cross-busy-road-salt-creek-D5E4G0.jpg">source</a></p>

<img class="col-sm-offset-4 col-sm-4 col-sm-offset-4" src="images/yolo-object-detection-opencv-python/object-detection4.jpg"/>

<p class="col-sm-offset-4 col-sm-4 col-sm-offset-4" id="source"><a href="https://pro-rankedboost.netdna-ssl.com/wp-content/uploads/2017/06/PUBG-New-Vehicle.jpg
">source</a></p>
<p id="source" class="col-sm-offset-3 col-sm-6 col-sm-offset-3">I do not own the copyright for the images used in this post. Please refer source for copyright info.</p>

<h2 class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Summary</h2>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">In this post, we looked at how to use OpenCV dnn module with pre-trained YOLO model to do object detection. We can also train a model to detect objects of our own interest that are not covered in the pre-trained one.</p>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">We have only scratched the surface. There is a lot more to object detection. I will be covering more on object detection in the future including other frameworks like Faster R-CNN and SSD. Be sure to subscribe to get notified when new posts are published.</p>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">That’s all for now. Thanks for reading. I hope this post was useful to get started with object detection. Feel free to share your comments or queries <a href="https://community.visiongeek.io/c/blog/yolo-object-detection-with-opencv-and-python">here</a> or using 
	the community widget at the bottom-right corner.</p>

<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">If you are getting value out of my work, consider supporting me on <a href="https://patreon.com/arunponnusamy">Patreon</a> and unlock exclusive benefits.</p>
<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Cheers.</p>
<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3"><script async data-uid="9a7f31108c" src="https://expert-musician-1659.ck.page/9a7f31108c/index.js"></script></p>

<h3 class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Update :</h3>
<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3">Checkout the object detection implementation available in <a href="http://cvlib.net">cvlib</a> which enables detecting common objects in the context through a single function call <code>detect_common_objects()</code>. Give it a shot and let me know your thoughts. Cheers.</p>

<h3 class="col-sm-offset-3 col-sm-6 col-sm-offset-3"><b>Recent posts</b></h3>
<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3"><a href="https://www.arunponnusamy.com/cnn-face-detector-dlib.html">CNN based face detector from dlib</a></p>
<p class="col-sm-offset-3 col-sm-6 col-sm-offset-3"><a href="https://www.arunponnusamy.com/deep-learning-setup-macos.html">Setting up deep learning environment the easy way on macOS High Sierra</a></p>


   </div>

</section>                   

<footer class="col-sm-offset-3 col-sm-6 col-sm-offset-3">
    <div class="row">
        <p class="col-sm-4">&copy; 2018 Arun Ponnusamy</p>
        <ul class="col-sm-8">
            <li class="col-sm-1"><a href="https://github.com/arunponnusamy"><img src="https://image.flaticon.com/icons/png/512/25/25231.png"></a></li>  
            <li class="col-sm-1"><a href="https://twitter.com/ponnusamy_arun"><img src="https://www.w3.org/2008/site/images/Twitter_bird_logo_2012.svg"></a></li>  
            <li class="col-sm-1"><a href="https://www.linkedin.com/in/arun-ponnusamy/"><img src="https://norfipc.com/img/logos/logotipo-oficial-linkedin-2014.png"></a></li>
            <li class="col-sm-1"><a href="https://www.quora.com/profile/Arun-Ponnusamy-2"><img src="http://cdn.embed.ly/providers/logos/quora.png"></a></li>
            <li class="col-sm-1" id="medium"><a href="https://medium.com/@arunponnusamy"><img src="http://www.stickpng.com/assets/images/5841c47ba6515b1e0ad75aa3.png"></a></li>  
    </div>
</footer>

</body>

</html>
